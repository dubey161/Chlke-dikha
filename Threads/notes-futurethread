# Future, Callable & CompletableFuture ‚Äî Concise Notes

---

## 1Ô∏è‚É£ Why These APIs Exist

* ThreadPoolExecutor runs tasks **asynchronously**.
* Caller needs:

  * task **status** (done / failed / cancelled)
  * **result** or **exception**
* ‚ûú `Future` provides this bridge between **caller** and **async task**.

---

## 2Ô∏è‚É£ Future (java.util.concurrent.Future)

**Definition:** Represents the result of an asynchronous computation.

### Key Methods

* `cancel(boolean mayInterrupt)` ‚Üí attempt to stop task
* `isCancelled()` ‚Üí was task cancelled?
* `isDone()` ‚Üí finished (success / failure / cancelled)
* `get()` ‚Üí block until completion
* `get(timeout, unit)` ‚Üí block with timeout

### Important Notes

* `submit()` **always returns a Future**
* `get()` is **blocking**
* `Future` itself does **not run tasks**

---

## 3Ô∏è‚É£ submit() ‚Äî Three Flavors

### 1. submit(Runnable)

```java
Future<?> f = executor.submit(() -> System.out.println("run"));
```

* Runnable returns nothing
* `Future<?>` ‚Üí result is `null`
* Used for **status tracking only**

---

### 2. submit(Runnable, result)

```java
List<Integer> list = new ArrayList<>();
Future<List<Integer>> f = executor.submit(() -> list.add(300), list);
```

* Returns provided object
* Works via **shared mutable state**
* ‚ùå Not clean, workaround only

---

### 3. submit(Callable<T>) ‚≠ê (Best)

```java
Future<Integer> f = executor.submit(() -> 300);
```

* Returns value
* Can throw checked exceptions
* ‚úî Clean & type-safe

---

## 4Ô∏è‚É£ Runnable vs Callable

| Runnable             | Callable                 |
| -------------------- | ------------------------ |
| No return            | Returns value            |
| No checked exception | Throws checked exception |
| Old                  | Modern                   |

---

## 5Ô∏è‚É£ FutureTask (Internal Working)

* `submit()` wraps task into **FutureTask**
* `FutureTask` implements `RunnableFuture`
* Maintains task state:

```
NEW ‚Üí RUNNING ‚Üí COMPLETED / FAILED / CANCELLED
```

---

## 6Ô∏è‚É£ CompletableFuture (Java 8+)

**Advanced Future with chaining & non-blocking style**

Implements:

* `Future`
* `CompletionStage`

---

## 7Ô∏è‚É£ supplyAsync() ‚Äî Start Async Task

```java
CompletableFuture<String> cf =
    CompletableFuture.supplyAsync(() -> "Hello");
```

* Uses **ForkJoinPool.commonPool()** by default

### With custom executor

```java
CompletableFuture.supplyAsync(() -> "Hello", executor);
```

---

## 8Ô∏è‚É£ thenApply vs thenApplyAsync

```java
cf.thenApply(v -> v + " World");
```

* Same thread

```java
cf.thenApplyAsync(v -> v + " World");
```

* New thread (ForkJoinPool or provided executor)

---

## 9Ô∏è‚É£ thenCompose (Dependent Async Tasks)

Use when **Task 2 depends on Task 1 result**

```java
CompletableFuture<String> cf =
    CompletableFuture.supplyAsync(() -> "Hello")
        .thenCompose(v ->
            CompletableFuture.supplyAsync(() -> v + " World")
        );
```

* Maintains ordering
* Avoids nested futures

---

## üîü thenAccept (Terminal Stage)

```java
cf.thenAccept(result -> System.out.println(result));
```

* Consumes result
* Returns `CompletableFuture<Void>`
* Usually **end of chain**

---

## 1Ô∏è‚É£1Ô∏è‚É£ thenCombine (Parallel Tasks)

```java
CompletableFuture<Integer> f1 = CompletableFuture.supplyAsync(() -> 10);
CompletableFuture<String> f2 = CompletableFuture.supplyAsync(() -> "K");

CompletableFuture<String> combined =
    f1.thenCombine(f2, (a, b) -> a + b);
```

* Runs tasks in parallel
* Combines results

---

## 1Ô∏è‚É£2Ô∏è‚É£ When to Use What (Interview)

| Scenario        | API               |
| --------------- | ----------------- |
| Fire & forget   | Runnable          |
| Need result     | Callable          |
| Track status    | Future            |
| Async pipeline  | CompletableFuture |
| Dependent async | thenCompose       |
| Parallel merge  | thenCombine       |

---

## 1Ô∏è‚É£3Ô∏è‚É£ One-Line Interview Summary

> Future tracks async tasks, Callable returns values, and CompletableFuture enables non-blocking async pipelines with chaining.
